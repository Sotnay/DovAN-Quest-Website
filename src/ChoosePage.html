<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <base href="/">
    <link rel="stylesheet" type="text/css" href="../styles/style.css" >
    <title>Page de redirection</title>
</head>
<body>
    <h1> Bienvenue dans DovAN'Quest</h1>
    <img src='' id="avatar" class="rounded-full w-12 h-12 mr-3"/>
    <div id="name"></div>
    <a href="/DovUniversePart"> Univers de DovAN Quest - Cartes et documentation</a>
    <a href="/OvishPart"> Jouer Ã  l'Ovish </a>
    <a href="/ShopPart"> Boutique en ligne - Achats de dragons</a>

<script>
  window.onload = () => {
    const fragment = new URLSearchParams(window.location.hash.slice(1));
    const [accessToken, tokenType] = [fragment.get('access_token'), fragment.get('token_type')];

    if (!accessToken) {
        window.location.href('/')
    }

    fetch('https://discord.com/api/users/@me', {
    headers: {
        authorization: `${tokenType} ${accessToken}`,
    },
    })
    .then(result => result.json())
    .then(response => {
        console.log(response);
        const { username, discriminator, avatar, id} = response;
        //set the welcome username string
        document.getElementById('name').innerText = ` ${username}#${discriminator}`;

        //set the avatar image by constructing a url to access discord's cdn
        document.getElementById("avatar").src = `https://cdn.discordapp.com/avatars/${id}/${avatar}.jpg`;
    })
    .catch(console.error);


};
</script>
</body>
</html>